<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Tracking Delivery Order - SITTA UT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="layout">
    <header class="topbar">
        <h1>Tracking Delivery Order (DO)</h1>
        <p class="subtitle">Pantau status pengiriman bahan ajar mahasiswa</p>
        <nav>
            <a href="index.html" class="btn small">â¬… Kembali ke Beranda</a>
            <a href="stok.html" class="btn small secondary">ðŸ“š Stok Bahan Ajar</a>
        </nav>
    </header>

    <main id="tracking-app" class="container">
        <!-- Info DO -->
        <section class="card highlight">
            <h2>Informasi DO Terbaru</h2>
            <p>
                Nomor DO berikutnya: <strong v-text="nextDoNumber"></strong>
            </p>
            <p v-if="selectedPaket">
                Paket terpilih: <strong v-text="selectedPaket.nama"></strong> &mdash;
                Total Harga: <strong>Rp {{ formatRupiah(selectedPaket.harga) }}</strong>
            </p>
            <p v-else>
                Pilih paket untuk melihat total harga.
            </p>
        </section>

        <!-- Form Tambah DO -->
        <section class="card">
            <h2>Tambah Data Delivery Order Baru</h2>
            <form @submit.prevent="addDo" class="form-grid">
                <div class="form-group">
                    <label>Nomor DO (otomatis)</label>
                    <input type="text" :value="nextDoNumber" disabled>
                </div>

                <div class="form-group">
                    <label>NIM</label>
                    <input v-model="form.nim" type="text">
                    <small class="error" v-if="errors.nim" v-text="errors.nim"></small>
                </div>

                <div class="form-group">
                    <label>Nama</label>
                    <input v-model="form.nama" type="text">
                    <small class="error" v-if="errors.nama" v-text="errors.nama"></small>
                </div>

                <div class="form-group">
                    <label>Ekspedisi</label>
                    <select v-model="form.ekspedisi">
                        <option value="">Pilih Ekspedisi</option>
                        <option v-for="e in pengirimanList" :key="e.kode" :value="e.kode">
                            {{ e.nama }}
                        </option>
                    </select>
                    <small class="error" v-if="errors.ekspedisi" v-text="errors.ekspedisi"></small>
                </div>

                <div class="form-group">
                    <label>Paket Bahan Ajar</label>
                    <select v-model="form.paketKode">
                        <option value="">Pilih Paket</option>
                        <option v-for="p in paket" :key="p.kode" :value="p.kode">
                            {{ p.kode }} - {{ p.nama }}
                        </option>
                    </select>
                    <small class="error" v-if="errors.paketKode" v-text="errors.paketKode"></small>
                </div>

                <div class="form-group full" v-if="selectedPaket">
                    <label>Isi Paket</label>
                    <ul class="pill-list">
                        <li v-for="kodeMk in selectedPaket.isi" :key="kodeMk" v-text="kodeMk"></li>
                    </ul>
                </div>

                <div class="form-group">
                    <label>Tanggal Kirim</label>
                    <input v-model="form.tanggalKirim" type="date">
                    <small class="error" v-if="errors.tanggalKirim" v-text="errors.tanggalKirim"></small>
                </div>

                <div class="form-group">
                    <label>Total Harga (otomatis)</label>
                    <input type="text" :value="selectedPaket ? 'Rp ' + formatRupiah(selectedPaket.harga) : '-'"
                        disabled>
                </div>

                <div class="form-group full">
                    <label>Catatan Perjalanan Awal (opsional)</label>
                    <input v-model="form.catatanAwal" type="text" placeholder="Misal: DO dibuat di loket TANGSEL">
                </div>

                <div class="form-actions full">
                    <button type="submit" class="btn primary">Simpan DO</button>
                </div>
            </form>
        </section>

        <!-- Daftar DO -->
        <section class="card">
            <h2>Daftar Delivery Order</h2>
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nomor DO</th>
                            <th>NIM</th>
                            <th>Nama</th>
                            <th>Ekspedisi</th>
                            <th>Paket</th>
                            <th>Tanggal Kirim</th>
                            <th>Total Harga</th>
                            <th>Status</th>
                            <th>Perjalanan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="doItem in doList" :key="doItem.nomor">
                            <td v-text="doItem.nomor"></td>
                            <td v-text="doItem.nim"></td>
                            <td v-text="doItem.nama"></td>
                            <td>
                                {{ getEkspedisiName(doItem.ekspedisi) }}
                            </td>
                            <td v-text="doItem.paketNama"></td>
                            <td v-text="doItem.tanggalKirim"></td>
                            <td>Rp {{ formatRupiah(doItem.total) }}</td>
                            <td>
                                <span class="badge badge-info" v-text="doItem.status"></span>
                            </td>
                            <td>
                                <ul class="timeline">
                                    <li v-for="(step, idx) in doItem.perjalanan" :key="idx">
                                        <strong v-text="step.waktu"></strong> &mdash;
                                        <span v-text="step.keterangan"></span>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                        <tr v-if="doList.length === 0">
                            <td colspan="9" class="text-center">Belum ada data DO.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer class="footer">
        <small>SITTA UT - Halaman Tracking DO</small>
    </footer>

    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- App logic -->
    <script src="js/tracking-app.js"></script>
</body>

</html>