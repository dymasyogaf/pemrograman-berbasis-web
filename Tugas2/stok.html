<!--
  Berkas: stok.html
  Keterangan: Halaman manajemen stok bahan ajar untuk aplikasi SITTA UT
  Fungsi: Menampilkan, mengelola, dan memantau stok bahan ajar di seluruh UT Daerah
  Fitur: Filter berdasarkan UT-Daerah dan kategori, sorting, edit inline, dan tambah stok baru
  Digunakan untuk: Mengelola inventaris bahan ajar Universitas Terbuka
-->
<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Stok Bahan Ajar - SITTA UT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/stok.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="layout">
    <header class="topbar">
        <div class="header-content">
            <h1>Stok Bahan Ajar</h1>
            <p class="subtitle">Manajemen stok bahan ajar untuk seluruh UT Daerah</p>
        </div>
        <nav class="main-nav" id="main-nav">
            <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-menu" id="nav-menu">
                <a href="index.html" class="nav-link">üè† Beranda</a>
                <a href="stok.html" class="nav-link active">üìö Stok Bahan Ajar</a>
                <a href="tracking.html" class="nav-link">üì¶ Tracking DO</a>
            </div>
        </nav>
    </header>

    <main id="stok-app" class="container">
        <!-- Ringkasan -->
        <section class="card highlight">
            <h2>üìä Ringkasan Stok</h2>
            <div class="stats-row">
                <div class="stat-box">
                    <span class="stat-label">Total Item</span>
                    <span class="stat-number" v-text="totalItems"></span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Stok Aman</span>
                    <span class="stat-number text-success" v-text="totalAman"></span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Stok Menipis</span>
                    <span class="stat-number text-warning" v-text="totalMenipis"></span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Stok Kosong</span>
                    <span class="stat-number text-danger" v-text="totalKosong"></span>
                </div>
            </div>
            <div class="alert-box" v-if="lowStockReminder">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div class="alert-content">
                    <strong v-text="lowStockReminder"></strong>
                </div>
            </div>
        </section>

        <!-- Filter & Sort -->
        <section class="card">
            <h2>üîç Filter & Pengurutan</h2>
            <div class="filters">
                <div class="filter-group">
                    <label>UT-Daerah</label>
                    <select v-model="selectedUpbjj">
                        <option value="">Semua UT-Daerah</option>
                        <option v-for="u in upbjjList" :key="u" :value="u" v-text="u"></option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Kategori Mata Kuliah</label>
                    <select v-model="selectedKategori" :disabled="!selectedUpbjj">
                        <option value="">Semua Kategori</option>
                        <option v-for="k in kategoriList" :key="k" :value="k" v-text="k"></option>
                    </select>
                    <small v-if="!selectedUpbjj" class="hint">
                        Pilih UT-Daerah terlebih dahulu untuk mengatur kategori
                    </small>
                </div>

                <div class="filter-group checkbox-group">
                    <label><input type="checkbox" v-model="showLowStockOnly"> Hanya stok < safety</label>
                    <label><input type="checkbox" v-model="showEmptyOnly"> Hanya stok kosong</label>
                </div>

                <div class="filter-group">
                    <label>Sortir berdasarkan</label>
                    <select v-model="sortKey">
                        <option value="judul">Judul</option>
                        <option value="qty">Stok</option>
                        <option value="harga">Harga</option>
                    </select>
                    <select v-model="sortDir">
                        <option value="asc">Naik (A-Z / Kecil-Besar)</option>
                        <option value="desc">Turun (Z-A / Besar-Kecil)</option>
                    </select>
                </div>

                <div class="filter-actions">
                    <button class="btn secondary" @click="resetFilters">üîÑ Reset Filter</button>
                </div>
            </div>
        </section>

        <!-- Tabel Stok -->
        <section class="card">
            <h2>üìã Daftar Stok Bahan Ajar</h2>
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Kode MK</th>
                            <th>Judul</th>
                            <th>Kategori</th>
                            <th>UT-Daerah</th>
                            <th>Lokasi Rak</th>
                            <th>Harga</th>
                            <th>Stok</th>
                            <th>Safety</th>
                            <th>Status</th>
                            <th>Catatan</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in sortedStocks" :key="item.kode">
                            <td v-text="item.kode"></td>
                            <td v-text="item.judul"></td>
                            <td v-text="item.kategori"></td>
                            <td v-text="item.upbjj"></td>
                            <td>
                                <span v-if="!item._editing" v-text="item.lokasiRak"></span>
                                <input v-else v-model="item.lokasiRak" class="edit-input" />
                            </td>
                            <td>Rp {{ formatRupiah(item.harga) }}</td>
                            <td>
                                <span v-if="!item._editing" v-text="item.qty"></span>
                                <input v-else type="number" min="0" v-model.number="item.qty" class="edit-input" />
                            </td>
                            <td v-text="item.safety"></td>
                            <td>
                                <span :class="['badge', getStatusClass(item)]" v-text="getStatusLabel(item)"></span>
                            </td>
                            <td>
                                <!-- catatanHTML wajib pakai v-html -->
                                <span v-html="item.catatanHTML"></span>
                            </td>
                            <td>
                                <button v-if="!item._editing" class="btn small" @click="editRow(item)">‚úèÔ∏è Edit</button>
                                <div v-else class="inline-actions">
                                    <button class="btn small primary" @click="saveRow(item)">üíæ Simpan</button>
                                    <button class="btn small secondary" @click="cancelEdit(item, index)">‚ùå Batal</button>
                                </div>
                            </td>
                        </tr>
                        <tr v-if="sortedStocks.length === 0">
                            <td colspan="11" class="text-center">üì≠ Tidak ada data yang sesuai filter.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Form Tambah Stok -->
        <section class="card">
            <h2>‚ûï Tambah Data Bahan Ajar Baru</h2>
            <form @submit.prevent="addStock" class="form-grid">
                <div class="form-group">
                    <label>Kode MK</label>
                    <input v-model="form.kode" type="text" placeholder="Contoh: EKMA4116" />
                    <small class="error" v-if="errors.kode" v-text="errors.kode"></small>
                </div>

                <div class="form-group">
                    <label>Judul Mata Kuliah</label>
                    <input v-model="form.judul" type="text" placeholder="Contoh: Pengantar Manajemen" />
                    <small class="error" v-if="errors.judul" v-text="errors.judul"></small>
                </div>

                <div class="form-group">
                    <label>Kategori</label>
                    <select v-model="form.kategori">
                        <option value="">Pilih Kategori</option>
                        <option v-for="k in kategoriList" :key="k" :value="k" v-text="k"></option>
                    </select>
                    <small class="error" v-if="errors.kategori" v-text="errors.kategori"></small>
                </div>

                <div class="form-group">
                    <label>UT-Daerah</label>
                    <select v-model="form.upbjj">
                        <option value="">Pilih UT-Daerah</option>
                        <option v-for="u in upbjjList" :key="u" :value="u" v-text="u"></option>
                    </select>
                    <small class="error" v-if="errors.upbjj" v-text="errors.upbjj"></small>
                </div>

                <div class="form-group">
                    <label>Lokasi Rak</label>
                    <input v-model="form.lokasiRak" type="text" placeholder="Misal: R1-A3" />
                </div>

                <div class="form-group">
                    <label>Harga (Rp)</label>
                    <input v-model.number="form.harga" type="number" min="0" placeholder="Contoh: 65000" />
                    <small class="error" v-if="errors.harga" v-text="errors.harga"></small>
                </div>

                <div class="form-group">
                    <label>Qty Stok</label>
                    <input v-model.number="form.qty" type="number" min="0" placeholder="Contoh: 25" />
                    <small class="error" v-if="errors.qty" v-text="errors.qty"></small>
                </div>

                <div class="form-group">
                    <label>Safety Stok</label>
                    <input v-model.number="form.safety" type="number" min="0" placeholder="Contoh: 20" />
                    <small class="error" v-if="errors.safety" v-text="errors.safety"></small>
                </div>

                <div class="form-group full">
                    <label>Catatan (HTML ringan opsional)</label>
                    <input v-model="form.catatanHTML" type="text"
                        placeholder="Misal: <em>Edisi terbaru</em>" />
                </div>

                <div class="form-actions full">
                    <button type="submit" class="btn primary">‚ûï Tambah Bahan Ajar</button>
                </div>
            </form>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 SITTA UT - Halaman Stok Bahan Ajar</p>
            <p class="footer-note">Universitas Terbuka</p>
        </div>
    </footer>

    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- Data -->
    <script src="js/dataBahanAjar.js"></script>
    <!-- App logic -->
    <script src="js/stok-app.js"></script>
    
    <script>
        // Mobile Navigation Toggle
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            const navLinks = document.querySelectorAll('.nav-link');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    navToggle.classList.toggle('active');
                });
                
                // Close menu when clicking on a link
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        navMenu.classList.remove('active');
                        navToggle.classList.remove('active');
                    });
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (!navToggle.contains(event.target) && !navMenu.contains(event.target)) {
                        navMenu.classList.remove('active');
                        navToggle.classList.remove('active');
                    }
                });
            }
        });
    </script>

</body>

</html>